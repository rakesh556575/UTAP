version: 6
name: ci

on:
  push:
    branches: master

jobs:
  Build:
    runs-on: ubuntu-latest
    steps:


      -
        name: Login to Docker Hub
        uses: docker/login-action@v1
        with:
          username: ${{ secrets.DOCKERHUB_USERNAME }}
          password: ${{ secrets.DOCKER_PASSWORD }}
      - uses: actions/checkout@v2
      - run: cd uiapp && docker build -t rakesh556575/ui:vers'${{ version }}' .
      - run: docker push  rakesh556575/ui:vers'${{ version }}'
      - uses: Azure/aks-set-context@v1
        with:
          creds: '${{ secrets.AZURE_CREDENTIALS }}'
          cluster-name: UTAP
          resource-group: DefaultResourceGroup-EUS
      - uses: Azure/k8s-deploy@v1
        with:
            manifests: |
              manifests/deployment.yaml
              manifests/service.yaml
              manifests/ingresssvc.yaml

